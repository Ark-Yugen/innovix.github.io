<!DOCTYPE html>
<html>
<head>
  <title>o</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Satyen Sriyanshu">
  <link rel="stylesheet" href="fontawesome/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Julius+Sans+One&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/contact.css">
  <link rel="stylesheet" href="css/portfolio.css">
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css">
  <link rel="shortcut icon" type="image/x-icon" href="images/logopfcweb.png"/>
  <link rel="manifest" href="manifest.json">
</head>

<body>
  <!-- ... your nav / home / about / portfolio markup unchanged ... -->

  <div id="contact">
    <div id="contact-container">
      <h1 id="contact-header">contact me<span class="green-detail">:</span></h1>

      <!-- updated form: IDs are required by the JS -->
      <form id="contactForm" class="contact-form" autocomplete="on">
        <input type="text" class="contact-form-text" id="name" name="name" placeholder="Name">
        <input type="email" class="contact-form-text" id="mail" name="mail" placeholder="E-mail">
        <textarea class="contact-form-text" id="message" name="message" placeholder="Message"></textarea>
        <button type="submit" class="contact-form-btn">Send</button>
      </form>
    </div>
  </div>

  <!-- ... footer unchanged ... -->

  <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="js/main.js"></script>
  <script src="js/components.js"></script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js").catch(()=>{});
    }

    (function () {
      const username = 'ark_yugen'; // the recipient username

      function buildMessage(name, email, text) {
        let telegramMessage = 'hii\n\n';
        if (name) telegramMessage += 'Name: ' + name + '\n';
        if (email) telegramMessage += 'Email: ' + email + '\n';
        if (text) telegramMessage += 'Message: ' + text + '\n';
        return telegramMessage;
      }

      const form = document.getElementById('contactForm');
      if (!form) return;

      form.addEventListener('submit', async function (e) {
        e.preventDefault();

        const name  = (document.getElementById('name').value || '').trim();
        const email = (document.getElementById('mail').value || '').trim();
        const text  = (document.getElementById('message').value || '').trim();

        const message = buildMessage(name, email, text);
        const encoded = encodeURIComponent(message);

        // candidate URLs (try in order)
        const tgResolve = `tg://resolve?domain=${username}&text=${encoded}`; // best for app
        const tMeUser   = `https://t.me/${username}?text=${encoded}`;      // t.me with text param
        const shareUrl  = `https://t.me/share/url?url=&text=${encoded}`;   // generic share dialog

        // Try protocol handler first (mobile app). If it fails, fallback to t.me user URL.
        // NOTE: it's impossible to 100% detect success of protocol handler; we do a timed fallback.
        // Use location.href for protocol attempt (user gesture) and fallback after short delay.
        let didFallback = false;

        // Try tg protocol (this will open the Telegram app on mobile if handler exists)
        try {
          // Use location assignment (works better than window.open for tg://).
          window.location.href = tgResolve;
        } catch (err) {
          // ignore
        }

        // After a short delay, try opening the https t.me link in a new tab/window.
        // If popup blocked, we then copy the text to clipboard and open the generic share URL.
        setTimeout(async () => {
          if (didFallback) return;
          // Try to open the https t.me link in a new tab
          const win = window.open(tMeUser, '_blank');

          if (!win) {
            // popup blocked or couldn't open — fallback to copy+share
            try {
              await navigator.clipboard.writeText(message);
            } catch (err) {
              // clipboard may be unavailable; ignore
            }
            // open generic share dialog (user may need to select a contact)
            window.open(shareUrl, '_blank');

            // friendly instruction
            alert('Could not open Telegram directly. The message was copied to your clipboard — open Telegram and paste it to @' + username + ' then send.');
          }
        }, 700); // 700ms is a reasonable compromise (tweak if you like)
      });
    })();
  </script>

  <script src="fontawesome/js/all.min.js"></script>
</body>
</html>